(function(n,t,i){var r;r=function(){function r(){n.init()}var n;return n=r.prototype,r.prototype.newArea=i.observable(""),r.prototype.areas=i.observableArray([]),r.prototype.resize=function(){var r,n,i;i=t(window).width(),r=t("#areas article").length,n=(t("#areas article").outerWidth()+12)*r,i<n?t("body").width(n):t("body").width(i)},r.prototype.initAreaControls=function(){n.resize();t("#areas article").on("dragover",function(n){n.preventDefault()});t("#areas article").on("drop",function(i){var u,f,r,e,o,s;i.preventDefault(),s=parseInt(i.originalEvent.dataTransfer.getData("AreaID")),o=i.originalEvent.dataTransfer.getData("CardID"),e=t("*[data-cardid="+o+"]"),u=t(i.target).closest("#areas article"),f=t(u).data("areaid"),s!==f&&(r={},r.ID=o,r.AreaID=f,r.Name=t(e).text(),t.ajax({url:"api/cards/"+r.ID,type:"PUT",data:r}).done(function(){var n;n=u.find("ul"),n.append(e)}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again?")}))});t("#areas li").on("dragstart",function(n){var i,r;i=t(n.target).closest("#areas article").data("areaid"),r=t(n.target).data("cardid"),n.originalEvent.dataTransfer.setData("AreaID",i),n.originalEvent.dataTransfer.setData("CardID",r)});t("#areas article footer div").hide();t("#areas article footer a").on("click",function(){var i,r,n,u;r=t("#areas article"),u=function(n){t(n).find("div").hide()};for(i in r)u(i);n=t(this).parent(),n.find("div").fadeToggle(),n.find("textarea").focus()});t("#areas textarea").live("focusout",function(){t(this).closest("article").find("div").fadeOut()})},r.prototype.refresh=function(){t.getJSON("api/areas").done(function(t){n.areas(t),n.initAreaControls()}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again?")})},r.prototype.showError=function(n){t("#error-modal").show(),t("#error-modal span").text(n)},r.prototype.addCard=function(){var r,i,u;r=this.ID,u=t("*[data-areaid="+r+"]").find("textarea").val(),i={},i.AreaID=r,i.Name=u,t.post("api/cards",i).done(function(){n.refresh()}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again?")})},r.prototype.addArea=function(){var i;i={},i.Name=n.newArea(),t.post("api/areas",i).done(function(){n.refresh()}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again?")}),t("#new-area").fadeToggle(),n.newArea("")},r.prototype.showArea=function(){t("#new-area").fadeToggle()},r.prototype.init=function(){t("#new-area").hide(),t("#error-modal").hide(),t(window).resize(function(){n.resize()}),t("#error-modal").live("click",function(){t(this).fadeOut()});t("body").on({ajaxStart:function(){t("#error-modal").hide(),t(this).addClass("loading")},ajaxStop:function(){t(this).removeClass("loading")}});n.refresh()},r}(),n.ViewModel=r})(window.Cards=window.Cards||{},jQuery,ko)