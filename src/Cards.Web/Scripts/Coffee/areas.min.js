(function(n,t,i){n.Class.AreasViewModel=function(){var n;return n=this,n.newArea=i.observable(""),n.areas=i.observableArray([]),n.resize=function(){var r,n,i;i=t(window).width(),r=t("#areas article").length,n=(t("#areas article").outerWidth()+12)*r,i<n?t("body").width(n):t("body").width(i)},n.initAreaControls=function(){n.resize();t("#areas article").on("dragover",function(n){n.preventDefault()});t("#areas article").on("drop",function(i){var u,f,r,e,o,s;i.preventDefault(),s=parseInt(i.originalEvent.dataTransfer.getData("AreaID")),o=i.originalEvent.dataTransfer.getData("CardID"),e=t("*[data-cardid="+o+"]"),u=t(i.target).closest("#areas article"),f=t(u).data("areaid"),s!==f&&(r={},r.ID=o,r.AreaID=f,r.Name=t(e).text(),t.ajax({url:"api/cards/"+r.ID,type:"PUT",data:r}).done(function(){var n;n=u.find("ul"),n.append(e)}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again?")}))});t("#areas li").on("dragstart",function(n){var i,r;i=t(n.target).closest("#areas article").data("areaid"),r=t(n.target).data("cardid"),n.originalEvent.dataTransfer.setData("AreaID",i),n.originalEvent.dataTransfer.setData("CardID",r)});t("#areas article footer div").hide();t("#areas article footer a").on("click",function(){var i,r,n,u;r=t("#areas article"),u=function(n){t(n).find("div").hide()};for(i in r)u(i);n=t(this).parent(),n.find("div").fadeToggle(),n.find("textarea").focus()});t("#areas textarea").on("keypress",function(n){return n.which===13?!1:!0});t("#areas textarea").on("keyup",function(n){n.which===13&&(n.preventDefault(),t(this).closest("#areas article").find("button").click())});t("#areas textarea").on("focusout",function(){t(this).closest("article").find("div").fadeOut()})},n.refresh=function(){t.getJSON("api/areas").done(function(t){n.areas(t),n.initAreaControls()}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again?")})},n.showError=function(n){t("#error-modal").show(),t("#error-modal span").text(n)},n.addCard=function(){var r,i,u;r=this.ID,u=t("*[data-areaid="+r+"]").find("textarea").val(),i={},i.AreaID=r,i.Name=u,t.post("api/cards",i).done(function(){n.refresh()}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again?")})},n.addArea=function(){var i;i={},i.Name=n.newArea(),t.post("api/areas",i).done(function(){n.refresh()}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again?")}),t("#new-area").fadeToggle(),n.newArea("")},n.showArea=function(){t("#new-area").fadeToggle(),t("#new-area input[type=text]").focus()},n.onReady=function(){i.applyBindings(n),t("#new-area").hide(),t("#error-modal").hide();t("#new-area input[type=text]").on("keyup",function(n){n.preventDefault(),n.which===13&&t("#new-area button").click()});t(window).resize(function(){n.resize()}),t("#error-modal").live("click",function(){t(this).fadeOut()});t("body").on({ajaxStart:function(){t("#error-modal").hide(),t(this).addClass("loading")},ajaxStop:function(){t(this).removeClass("loading")}});n.refresh()},n},n.createObject("AreasViewModel")})(window.cards,jQuery,ko)