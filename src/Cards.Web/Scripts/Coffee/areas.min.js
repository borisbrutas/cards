(function(){var n=[].indexOf||function(n){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===n)return t;return-1};(function(t,i,r,u){t.Class.AreasViewModel=function(){var f;return f=this,f.rootUrl=r("meta[name=cards-baseurl]").attr("content"),f.newArea=u.observable(""),f.filterString=u.observable(""),f.areas=u.observableArray([]),f.filterCards=function(){f.refresh()},f.resize=function(){var u,n,t;t=r(i).width(),u=r("#areas article").length,n=(r("#areas article").outerWidth()+12)*u,t<n?r("body").width(n):r("body").width(t)},f.getNoAgeAreas=function(){var n;return n=r("#areas").data("noage"),n.split(";")},f.hideBubbles=function(){var i,t,u,n,e;for(u=f.getNoAgeAreas(),t=r(".card-bubble"),n=0,e=t.length;n<e;n++)i=t[n],f.hideBubble(i,u)},f.hideBubble=function(t,i){var u,f;f=r(t),u=r(t).closest("article").find("header h1").text(),n.call(i,u)>=0&&f.hide()},f.bindCardAction=function(){r(".cards").on("click","li.card",function(){var n;n=r(this).data("cardid"),i.location.href="Cards/Edit/"+n})},f.colorizeCard=function(t,i){var e,u,o,s;u=r(t),s=u.data("stale"),o=f.getNoAgeAreas(),e=u.closest("article").find("header h1").text(),s>i&&n.call(o,e)<0&&u.addClass("card-aged")},f.colorizeLabel=function(n){var i,t;t=r(n),i=t.data("color"),t.css("background-color",i)},f.colorize=function(){var e,o,s,u,n,i,h,c;for(u=r("#labels span"),n=0,h=u.length;n<h;n++)s=u[n],f.colorizeLabel(s);for(e=r("#cards").data("aged"),t=r("#cards li"),i=0,c=t.length;i<c;i++)o=t[i],f.colorizeCard(o,e)},f.initControls=function(){f.resize(),r().dragScroll();r("#areas").on("dragover","article",function(n){n.preventDefault()}).on("drop","article",function(n){var u,e,t,i,o,s;n.preventDefault(),s=parseInt(n.originalEvent.dataTransfer.getData("AreaID")),o=n.originalEvent.dataTransfer.getData("CardID"),i=r("*[data-cardid="+o+"]"),u=r(n.target).closest("#areas article"),e=r(u).data("areaid"),s!==e&&(t={},t.ID=o,t.AreaID=e,t.Name=r(i).find("a").text(),r.ajax({url:f.rootUrl+"api/cards/"+t.ID,type:"PUT",data:t}).done(function(){var n;n=u.find("#cards"),i.removeClass("card-aged"),n.append(i)}).fail(function(){f.showError("Santa can't figured out what happened, can you try it again?")}))}).on("dragstart","article",function(n){var t,i;t=r(n.target).closest("#areas article").data("areaid"),i=r(n.target).closest("li").data("cardid"),n.originalEvent.dataTransfer.setData("AreaID",t),n.originalEvent.dataTransfer.setData("CardID",i)}).on("click","article footer a",function(n){var t;n.preventDefault(),t=r(this).parent().find("div"),t.is(":visible")||(t.fadeToggle(),t.find("textarea").focus())}).on("keypress","textarea",function(n){return n.which===13?!1:!0}).on("keyup","textarea",function(n){n.which===13&&(n.preventDefault(),r(this).closest("#areas article").find("button").click())}).on("focusout","textarea",function(){r(this).closest("article").find("div").fadeOut()});r("#new-area input[type=text]").on("keyup",function(n){n.preventDefault(),n.which===13&&r("#new-area button").click()});r(i).resize(function(){f.resize()}),r("#error-modal").live("click",function(){r(this).fadeOut()});r("body").on({ajaxStart:function(){r("#error-modal").hide(),r(this).addClass("loading")},ajaxStop:function(){r(this).removeClass("loading")}})},f.refresh=function(){r.getJSON(f.rootUrl+"api/areas?CardLabel="+f.filterString()).done(function(n){f.areas(n),f.resize(),f.colorize(),f.hideBubbles(),f.bindCardAction()}).fail(function(){f.showError("Santa can't figured out what happened, can you try it again?")})},f.showError=function(n){r("#error-modal").show(),r("#error-modal span").text(n)},f.addCard=function(){var t,n,i;t=this.ID,i=r("*[data-areaid="+t+"]").find("textarea").val(),n={},n.AreaID=t,n.Name=i,r.post(f.rootUrl+"api/cards",n).done(function(){f.refresh()}).fail(function(){f.showError("Santa can't figured out what happened, can you try it again?")})},f.addArea=function(){var n;n={},n.Name=f.newArea(),r.post(f.rootUrl+"api/areas",n).done(function(){f.refresh()}).fail(function(){f.showError("Santa can't figured out what happened, can you try it again?")}),r("#new-area").fadeToggle(),f.newArea("")},f.showArea=function(){r("#new-area").fadeToggle(),r("#new-area input[type=text]").focus()},f.onReady=function(){u.applyBindings(f),f.initControls(),f.refresh()},f},t.createObject("AreasViewModel")})(window.cards,window,jQuery,ko)}).call(this);
//@ sourceMappingURL=areas.min.js.map