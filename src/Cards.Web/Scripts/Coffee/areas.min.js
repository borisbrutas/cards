(function(n,t,i){var r;r=function(){function r(){n.init()}var n;return n=r.prototype,r.prototype.newArea=i.observable(""),r.prototype.areas=i.observableArray([]),r.prototype.resize=function(){var n,i;i=t(window).width(),n=(t("#areas article").outerWidth()+12)*5,i<n?t("body").width(n):t("body").width(i)},r.prototype.initAreaControls=function(){n.resize();t("#areas article").on("dragover",function(n){n.preventDefault()});t("#areas article").on("drop",function(i){var f,o,r,e,u;i.preventDefault(),u=i.originalEvent.dataTransfer.getData("CardID",u),e=t("*[data-cardid="+u+"]"),f=t(i.target).closest("#areas article"),o=t(f).data("areaid"),r={},r.ID=u,r.AreaID=o,r.Name=t(e).text(),t.ajax({url:"api/cards/"+r.ID,type:"PUT",data:r}).done(function(){var n;n=f.find("ul"),n.append(e)}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again?")})});t("#areas li").on("dragstart",function(n){var i;i=t(n.target).data("cardid"),n.originalEvent.dataTransfer.setData("CardID",i)});t("#areas article footer div").hide();t("#areas article footer a").on("click",function(){var i,r,n,u;r=t("#areas article"),u=function(n){t(n).find("div").hide()};for(i in r)u(i);n=t(this).parent(),n.find("div").fadeToggle(),n.find("textarea").focus()});t("#areas textarea").live("focusout",function(){t(this).closest("article").find("div").fadeOut()})},r.prototype.refresh=function(){t.getJSON("api/areas").done(function(t){n.areas(t),n.initAreaControls()}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again?")})},r.prototype.showError=function(n){t("#error-modal").show(),t("#error-modal span").text(n)},r.prototype.addCard=function(){var r,i,u;r=this.ID,u=t("*[data-areaid="+r+"]").find("textarea").val(),i={},i.AreaID=r,i.Name=u,t.post("api/cards",i).done(function(){n.refresh()}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again?")})},r.prototype.addArea=function(){var i;i={},i.Name=n.newArea(),t.post("api/areas",i).done(function(){n.refresh()}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again?")}),t("#new-area").fadeToggle(),n.newArea("")},r.prototype.showArea=function(){t("#new-area").fadeToggle()},r.prototype.init=function(){t("#new-area").hide(),t("#error-modal").hide(),t(window).resize(function(){n.resize()}),t("#error-modal").live("click",function(){t(this).fadeOut()});t("body").on({ajaxStart:function(){t("#error-modal").hide(),t(this).addClass("loading")},ajaxStop:function(){t(this).removeClass("loading")}});n.refresh()},r}(),n.ViewModel=r})(window.Cards=window.Cards||{},jQuery,ko)