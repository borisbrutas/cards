(function(n,t,i,r){n.Class.AreasViewModel=function(){var n;return n=this,n.rootUrl=i("meta[name=cards-baseurl]").attr("content"),n.newArea=r.observable(""),n.areas=r.observableArray([]),n.resize=function(){var u,n,r;r=i(t).width(),u=i("#areas article").length,n=(i("#areas article").outerWidth()+12)*u,r<n?i("body").width(n):i("body").width(r)},n.colorizeLabel=function(n){var r,t;t=i(n),r=t.data("color"),t.css("background-color",r)},n.colorize=function(){var u,r,t,f;for(r=i("#labels span"),t=0,f=r.length;t<f;t++)u=r[t],n.colorizeLabel(u)},n.initControls=function(){n.resize(),i().dragScroll();i("#areas").on("dragover","article",function(n){n.preventDefault()}).on("drop","article",function(t){var u,f,r,e,o,s;t.preventDefault(),s=parseInt(t.originalEvent.dataTransfer.getData("AreaID")),o=t.originalEvent.dataTransfer.getData("CardID"),e=i("*[data-cardid="+o+"]"),u=i(t.target).closest("#areas article"),f=i(u).data("areaid"),s!==f&&(r={},r.ID=o,r.AreaID=f,r.Name=i(e).find("a").text(),i.ajax({url:n.rootUrl+"api/cards/"+r.ID,type:"PUT",data:r}).done(function(){var n;n=u.find("ul"),n.append(e)}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again?")}))}).on("dragstart","article",function(n){var t,r;t=i(n.target).closest("#areas article").data("areaid"),r=i(n.target).closest("li").data("cardid"),n.originalEvent.dataTransfer.setData("AreaID",t),n.originalEvent.dataTransfer.setData("CardID",r)}).on("click","article footer a",function(n){var t;n.preventDefault(),t=i(this).parent().find("div"),t.is(":visible")||(t.fadeToggle(),t.find("textarea").focus())}).on("keypress","textarea",function(n){return n.which===13?!1:!0}).on("keyup","textarea",function(n){n.which===13&&(n.preventDefault(),i(this).closest("#areas article").find("button").click())}).on("focusout","textarea",function(){i(this).closest("article").find("div").fadeOut()});i("#new-area input[type=text]").on("keyup",function(n){n.preventDefault(),n.which===13&&i("#new-area button").click()});i(t).resize(function(){n.resize()}),i("#error-modal").live("click",function(){i(this).fadeOut()});i("body").on({ajaxStart:function(){i("#error-modal").hide(),i(this).addClass("loading")},ajaxStop:function(){i(this).removeClass("loading")}})},n.refresh=function(){i.getJSON(n.rootUrl+"api/areas").done(function(t){n.areas(t),n.resize(),n.colorize()}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again?")})},n.showError=function(n){i("#error-modal").show(),i("#error-modal span").text(n)},n.addCard=function(){var r,t,u;r=this.ID,u=i("*[data-areaid="+r+"]").find("textarea").val(),t={},t.AreaID=r,t.Name=u,i.post(n.rootUrl+"api/cards",t).done(function(){n.refresh()}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again?")})},n.addArea=function(){var t;t={},t.Name=n.newArea(),i.post(n.rootUrl+"api/areas",t).done(function(){n.refresh()}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again?")}),i("#new-area").fadeToggle(),n.newArea("")},n.showArea=function(){i("#new-area").fadeToggle(),i("#new-area input[type=text]").focus()},n.onReady=function(){r.applyBindings(n),n.initControls(),n.refresh()},n},n.createObject("AreasViewModel")})(window.cards,window,jQuery,ko)