(function(){(function(n,t,i){n.Class.CardViewModel=function(){var n;return n=this,n.rootUrl=t("meta[name=cards-baseurl]").attr("content"),n.card={},n.showError=function(n){t("#error-modal").show(),t("#error-modal span").text(n)},n.initControls=function(){t("#error-modal").live("click",function(){t(this).fadeOut()});t("body").on({ajaxStart:function(){t("#error-modal").hide(),t(this).addClass("loading")},ajaxStop:function(){t(this).removeClass("loading")}})},n.deleteCard=function(){var r;r=i.mapping.toJS(n.card),t.ajax({url:n.rootUrl+"api/cards/"+r.ID,type:"DELETE"}).done(function(){window.location.href=n.rootUrl+"areas"}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again")})},n.updateCard=function(){var r;r=i.mapping.toJS(n.card),t.ajax({url:n.rootUrl+"api/cards/"+r.ID,type:"PUT",data:r}).done(function(){window.location.href=n.rootUrl+"areas"}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again")})},n.getCard=function(){var r;r=t(".edit-section").data("cardid"),t.getJSON(n.rootUrl+"api/cards/"+r).done(function(t){n.card=i.mapping.fromJS(t),n.card.DueDateText=i.computed({read:function(){return moment(n.card.DueDateUtc()).format("L")},write:function(t){n.card.DueDateUtc(t)}}),i.applyBindings(n)}).fail(function(){n.showError("Santa can't figured out what happened, can you try it again")})},n.onReady=function(){n.initControls(),n.getCard()},n},n.createObject("CardViewModel")})(cards,jQuery,ko)}).call(this)